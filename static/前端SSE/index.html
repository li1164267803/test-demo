<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SSE</title>
</head>

<body></body>
<script>
    // http://www.ruanyifeng.com/blog/2017/05/server-sent_events.html
    // 跨域问题，后端处理
    // 类似webscort，但只能是后端向前端发送数据
    if ("EventSource" in window) {
        //   let url = "http://192.168.0.157:8080/sse/object";
        //     let source = new EventSource(url, {
        //     withCredentials: true,
        // });
        // let url2 = 'http://192.168.2.135:8103/task/testMq'
        let url = 'http://123.56.135.138:8102/server/connect?classId=123&chapterId=192726700895019008'
        let source = new EventSource(url);
        // eventSource实例的readyState属性，表明连接的当前状态。该属性只读，可以取以下值。
        // 0：相当于常量eventSource.CONNECTING，表示连接还未建立，或者断线正在重连。
        // 1：相当于常量eventSource.OPEN，表示连接已经建立，可以接受数据。
        // 2：相当于常量eventSource.CLOSED，表示连接已断，且不会重连。
        console.log(source, "source");
        source.onopen = function (event) {
            console.log("建立链接", event);
        };
        source.onmessage = function (event) {
            var data = event.data;
            console.log("返回的数据", data);
        };
        source.onerror = function (error) {
            console.log("通信错误", error);
        };
        // setTimeout(() => {
        //     source.close();
        //     var ajax = new XMLHttpRequest();
        //     ajax.open('get', 'http://192.168.2.135:8103/server/disconnect?classId=2&chapterId=2');
        //     ajax.send();
        //     ajax.onreadystatechange = function () {
        //         if (ajax.readyState == 4 && ajax.status == 200) {
        //             console.log('关闭请求');
        //         }
        //     }
        //     console.log('关闭sse');
        // }, 5000);

    }
</script>

</html>